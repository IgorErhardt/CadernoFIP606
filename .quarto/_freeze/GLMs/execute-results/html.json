{
  "hash": "15d76afa36eb48cd3c544b5bdc940928",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Modelos\"\nwarning: False\n---\n\n\n\n\n### Modelos lineares generalizados\n\nOs modelos lineares generalizados permitem a modelagem de variáveis respostas que não seguem a distribuição normal. São necessáio definir três componentes básico:\n\n-   **Distribuição da probabilidade**: padrão de distribuição da variábel resposta. De acordo com a natureza da variável sua distribuição adota comportamentos distinto, sendo necessário respeitar essa distribuição. Por exemplo: Dados contínuos com variância constante seguem a distruibuição **gaussiana/normal**. Dados de contagem/frequência seguem a distribuição de **Poisson**. Dados de probabilidade seguem a distribuição **binomial**.\n\n-   **Preditor linear**: Combinação das variáveis preditoras e seus respectivos coeficientes.\n\n    $$\n    \\eta = \\beta_0 + \\beta_1 X_1 + \\beta_2 X_2 + \\cdots + \\beta_p X_p\n    $$\n\n-   **Função de ligação**: É a função monotônica que relaciona o preditor linear a média da distribuição, garantindo que o valor predito permaneça dentro da distribuição por meio da tranformação do valor.\n\n-   Identidade (Gaussiana)\n\n    $$\n    g(\\mu) = \\eta\n    $$\n\n-   Log (Poisson)\n\n$$\ng(\\mu) = \\log(\\mu)\n$$\n\n-   Logito (Binomial)\n\n$$\ng(\\mu) = \\log\\left( \\frac{\\mu}{1 - \\mu} \\right)\n$$\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(DHARMa)\nlibrary(emmeans)\nlibrary(multcomp)\nlibrary(car)\nlibrary(performance)\nlibrary(gsheet)\nlibrary(ggplot2)\nlibrary(agricolae)\nlibrary(epifitter)\nlibrary(dplyr)\nlibrary(MASS)\nlibrary(tidyverse)\nlibrary(lme4)\nlibrary(drc)\nlibrary(ec50estimator)\n```\n:::\n\n\n\n\nInicialmente vamos verificar o comportamento e homogenidade das variâncias, para confirmar que os métodos paramétricos não podem ser adotados. Dessa vamos utilizaremos o DHARMa para visualização dos pressupostos.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nInsectsDataframe = InsectSprays\nInsectsDataframe |>\n  ggplot(aes(spray, count))+\n  geom_boxplot(outlier.color=NULL)+\n  geom_jitter(width=0.1)\n```\n\n::: {.cell-output-display}\n![](GLMs_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\nInsectLM = lm(count ~ spray, data=InsectsDataframe)\nplot(simulateResiduals(InsectLM))\n```\n\n::: {.cell-output-display}\n![](GLMs_files/figure-html/unnamed-chunk-2-2.png){width=672}\n:::\n\n```{.r .cell-code}\nshapiro.test(residuals(InsectLM))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  residuals(InsectLM)\nW = 0.96006, p-value = 0.02226\n```\n\n\n:::\n:::\n\n\n\n\nAjustando um glm com a distribuição Poisson, adequada a natureza do conjuto de dados, podemos indetificar os grupos distintos de inseticidas.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nInsectGLM= glm(count ~spray, data = InsectsDataframe, family=poisson)\nmediasGLM = emmeans(InsectGLM, ~spray, type=(\"response\"))\ncld(mediasGLM)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n spray  rate    SE  df asymp.LCL asymp.UCL .group\n C      2.08 0.417 Inf      1.41      3.08  1    \n E      3.50 0.540 Inf      2.59      4.74  12   \n D      4.92 0.640 Inf      3.81      6.35   2   \n A     14.50 1.100 Inf     12.50     16.82    3  \n B     15.33 1.130 Inf     13.27     17.72    3  \n F     16.67 1.180 Inf     14.51     19.14    3  \n\nConfidence level used: 0.95 \nIntervals are back-transformed from the log scale \nP value adjustment: tukey method for comparing a family of 6 estimates \nTests are performed on the log scale \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n\n```{.r .cell-code}\ncheck_model(InsectGLM)\n```\n\n::: {.cell-output-display}\n![](GLMs_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\nsummary(InsectGLM)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = count ~ spray, family = poisson, data = InsectsDataframe)\n\nCoefficients:\n            Estimate Std. Error z value Pr(>|z|)    \n(Intercept)  2.67415    0.07581  35.274  < 2e-16 ***\nsprayB       0.05588    0.10574   0.528    0.597    \nsprayC      -1.94018    0.21389  -9.071  < 2e-16 ***\nsprayD      -1.08152    0.15065  -7.179 7.03e-13 ***\nsprayE      -1.42139    0.17192  -8.268  < 2e-16 ***\nsprayF       0.13926    0.10367   1.343    0.179    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 409.041  on 71  degrees of freedom\nResidual deviance:  98.329  on 66  degrees of freedom\nAIC: 376.59\n\nNumber of Fisher Scoring iterations: 5\n```\n\n\n:::\n:::\n\n\n\n\n### Modelos Mistos\n\nModelos mistos permitem trabalharmos com dois diferentes tipos de efeitos ao mesmo tempo. Efeitos fixos, são os efeitos a nível de população cujo impacto sobre a resposta buscamos compreender, esses efeitos deve persistir ao longo das repetições uma vez que não são fonte de aleatoriedade. Efeitos aleatórios, representam fontes de variabilidade que não são de interesse, indicando assim a tendência de variação ao longo de níves de agrupamento.\n\nA utilização de modelos mistos auxiliam a evitar a consideração equivocada de amostras independentes, quando na realidade não são, denominado erro de \"pseud-replicação\". Ao tratar a população como um todo levando a um exagerado grau de liberdade e p-valor, levando a conclusões equivocadas. Os modelos mistos são capazes de reconhecer a estrutura de correlação entre os agrupamentos, evitando estimativas enviesadas dos coeficientes dos efeitos fixos.\n\nDe forma simplificada, são estimados simultaneamente os coeficientes globais para cada variável preditora dos efeitos fixos, enquanto se é predito o desvio dos coeficientes estimados em cada grupo em relação aos coeficientes globais. Ocorre então um ajuste, \"encolhimento\", em que os valores de coeficientes são ajustados para minimizar o desvio reduzindo a variância total.\n\n$$\n\\mathbf{y} = \\mathbf{X}\\boldsymbol{\\beta} + \\mathbf{Z}\\boldsymbol{u} + \\boldsymbol{\\epsilon}, \\quad \\boldsymbol{u} \\sim \\mathcal{N}(\\mathbf{0},\\,\\mathbf{G}), \\quad \\boldsymbol{\\epsilon} \\sim \\mathcal{N}(\\mathbf{0},\\,\\mathbf{R})\n$$\n\n$$\n\\begin{array}{ll}\\hline\\text{Símbolo} & \\text{Definição} \\\\\\hline\\mathbf{y} & \\text{vetor de observações (n×1), }E(\\mathbf{y}) = \\mathbf{X}\\boldsymbol{\\beta}\\\\\\mathbf{X} & \\text{matriz de projeto dos efeitos fixos (n×p)}\\\\\\boldsymbol{\\beta} & \\text{parâmetros dos efeitos fixos (p×1), estimados via ML/REML}\\\\\\mathbf{Z} & \\text{matriz de projeto dos efeitos aleatórios (n×q)}\\\\\\mathbf{u} & \\text{efeitos aleatórios (q×1), }E(\\mathbf{u})=0,\\,\\mathrm{Var}(\\mathbf{u})=\\mathbf{G}\\\\\\boldsymbol{\\epsilon} & \\text{erros residuais (n×1), }E(\\boldsymbol{\\epsilon})=0,\\,\\mathrm{Var}(\\boldsymbol{\\epsilon})=\\mathbf{R}\\\\\\mathbf{G} & \\text{matriz de covariância dos efeitos aleatórios (q×q)}\\\\\\mathbf{R} & \\text{matriz de covariância dos erros residuais (n×n)}\\\\\\hline\\end{array}\n$$\n\nPara exemplificar, consideremos o conjuto de dados abaixo em que foi observada a produtividade de cada híbrido sob dois diferentes métodos, em um experimento dirigido em estrutura DBC.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nCornDf = gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit?gid=1345524759#gid=1345524759\")\nCornDf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 48 × 5\n   hybrid   block method index yield\n   <chr>    <dbl> <chr>  <dbl> <dbl>\n 1 30F53 HX     1 pin     21.1 12920\n 2 30F53 HX     2 pin     21.1  9870\n 3 30F53 HX     3 pin     23.3  8920\n 4 30F53 HX     4 pin     35.6 13120\n 5 30F53 YH     1 pin     21.1 12060\n 6 30F53 YH     2 pin     22.2  7860\n 7 30F53 YH     3 pin     27.3  7410\n 8 30F53 YH     4 pin     27.8 10300\n 9 30K64        1 pin     20   11700\n10 30K64        2 pin     20   10700\n# ℹ 38 more rows\n```\n\n\n:::\n:::\n\n\n\n\nPodemos tratar os blocos como fator aleatório de forma a minimizar o impactos da variabilidade entre blocos nas estimativas. Enquanto avaliamos a influência do efeito fixos index, hybrid e a interação dos mesmo.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nCornDf$Id = interaction(CornDf$hybrid, CornDf$block)\nMCorn = lmer(index ~hybrid*method + (1|block:Id), data=CornDf)\ncar::Anova(MCorn)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Deviance Table (Type II Wald chisquare tests)\n\nResponse: index\n                Chisq Df Pr(>Chisq)   \nhybrid        11.4239  5    0.04359 * \nmethod         4.6964  1    0.03023 * \nhybrid:method 15.8062  5    0.00742 **\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(simulateResiduals(MCorn))\n```\n\n::: {.cell-output-display}\n![](GLMs_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\nCornDf$predicted <- predict(MCorn)\n```\n:::\n\n\n\n\nUtilizando a tabela Anova, podemos identificar quais efeitos fixos apresentaram diferenças significativas, e utilizando a biblioteca DHARMa podemos visualizar a normalide e homocedasticidade dos resíduos.\n\nSeguindo a investigação podemos verificar quais híbridos apresentaram se distinguem entre si, em função do método.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nCornMeans = emmeans(MCorn, ~hybrid | method)\ncld(CornMeans, Letters = letters)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nmethod = pin:\n hybrid   emmean   SE   df lower.CL upper.CL .group\n BG7049H    19.4 3.57 24.9     12.1     26.8  a    \n 30K64      20.6 3.57 24.9     13.2     27.9  a    \n 30F53 YH   24.6 3.57 24.9     17.3     31.9  ab   \n 30F53 HX   25.3 3.57 24.9     17.9     32.6  ab   \n 30S31YH    32.5 3.57 24.9     25.2     39.8  ab   \n 30S31H     38.1 3.57 24.9     30.8     45.4   b   \n\nmethod = silk:\n hybrid   emmean   SE   df lower.CL upper.CL .group\n BG7049H    19.2 3.57 24.9     11.8     26.5  a    \n 30K64      21.5 3.57 24.9     14.2     28.8  a    \n 30F53 HX   25.0 3.57 24.9     17.7     32.3  a    \n 30F53 YH   26.2 3.57 24.9     18.9     33.6  a    \n 30S31H     26.5 3.57 24.9     19.2     33.8  a    \n 30S31YH    26.6 3.57 24.9     19.3     34.0  a    \n\nDegrees-of-freedom method: kenward-roger \nConfidence level used: 0.95 \nP value adjustment: tukey method for comparing a family of 6 estimates \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n:::\n\n\n\n\nOu então como os métodos se distinguem entre si em função do híbrido.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nCornMeans = emmeans(MCorn, ~method | hybrid)\ncld(CornMeans, Letters = letters)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nhybrid = 30F53 HX:\n method emmean   SE   df lower.CL upper.CL .group\n silk     25.0 3.57 24.9     17.7     32.3  a    \n pin      25.3 3.57 24.9     17.9     32.6  a    \n\nhybrid = 30F53 YH:\n method emmean   SE   df lower.CL upper.CL .group\n pin      24.6 3.57 24.9     17.3     31.9  a    \n silk     26.2 3.57 24.9     18.9     33.6  a    \n\nhybrid = 30K64:\n method emmean   SE   df lower.CL upper.CL .group\n pin      20.6 3.57 24.9     13.2     27.9  a    \n silk     21.5 3.57 24.9     14.2     28.8  a    \n\nhybrid = 30S31H:\n method emmean   SE   df lower.CL upper.CL .group\n silk     26.5 3.57 24.9     19.2     33.8  a    \n pin      38.1 3.57 24.9     30.8     45.4   b   \n\nhybrid = 30S31YH:\n method emmean   SE   df lower.CL upper.CL .group\n silk     26.6 3.57 24.9     19.3     34.0  a    \n pin      32.5 3.57 24.9     25.2     39.8  a    \n\nhybrid = BG7049H:\n method emmean   SE   df lower.CL upper.CL .group\n silk     19.2 3.57 24.9     11.8     26.5  a    \n pin      19.4 3.57 24.9     12.1     26.8  a    \n\nDegrees-of-freedom method: kenward-roger \nConfidence level used: 0.95 \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n:::\n\n\n\n\n### Modelos Não Lineares\n\nModelos não lineares são utilizados quando a relação entre a variável resposta e os preditores não pode ser adequadamente representada por uma combinação linear simples, mesmo após transformações. Diferentemente dos modelos lineares e generalizados, nesses modelos a forma funcional entre as variáveis é explicitamente não linear, podendo envolver exponenciais, logaritmos, polinômios de grau maior, funções sigmoides, entre outras.\n\nA modelagem não linear envolve a especificação de uma função paramétrica, cujo ajuste é feito geralmente por métodos iterativos de otimização, como mínimos quadrados não lineares ou máxima verossimilhança.\n\nComo exemplo vamos trabalhar com um conjunto de dados em que é avaliada a sensibilidade a fungicidas, a partir da contagem de germinação. Naturalmente esse tipo de dado é não linear, adotando um comportamento logístico. Vamos considerar a germinação média entre as reptições e analisar somente um fungicida para maior simplicidade. Para ajuste do modelo utilizaremos a função drm(), especificiando que deve-se utilizar o modelo log logistico (LL.3)\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nFungicideSensibility = gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit?gid=465348652#gid=465348652\")\n\nFungicideSensibility |> \n  group_by(code, dose) |>\n  summarise(germinationMean = mean(germination)) |>\n  ggplot(aes(dose, germinationMean))+\n  geom_point()+\n  facet_wrap(~code)\n```\n\n::: {.cell-output-display}\n![](GLMs_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n\n```{.r .cell-code}\nFGT43 = FungicideSensibility |> \n  group_by(code, dose) |>\n  summarise(germinationMean = mean(germination)) |>\n  filter(code==\"FGT43\")\nFGT43Model = drm(germinationMean ~dose,\n                 data=FGT43,\n                 fct=LL.3())\nplot(FGT43Model)\n```\n\n::: {.cell-output-display}\n![](GLMs_files/figure-html/unnamed-chunk-8-2.png){width=672}\n:::\n\n```{.r .cell-code}\nsummary(FGT43Model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nModel fitted: Log-logistic (ED50 as parameter) with lower limit at 0 (3 parms)\n\nParameter estimates:\n\n               Estimate Std. Error t-value   p-value    \nb:(Intercept)  1.219692   0.175081  6.9664  0.006069 ** \nd:(Intercept) 48.486911   1.456007 33.3013 5.952e-05 ***\ne:(Intercept)  0.495895   0.060851  8.1494  0.003864 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error:\n\n 1.636105 (3 degrees of freedom)\n```\n\n\n:::\n\n```{.r .cell-code}\nAIC(FGT43Model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 26.7762\n```\n\n\n:::\n:::\n\n\n\n\nComo um complemento podemos utilizar a já estabelecida referência de dose efetiva para reduzir 50% para comparar os fungicidas. Utilizando a função estimate_EC50()\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nEC50Df = estimate_EC50(germination ~ dose,\n              data=FungicideSensibility,\n              isolate_col = \"code\",\n              strata_col = \"state\",\n              interval = \"delta\",\n              fct= drc::LL.3())\nEC50Df|>\n  ggplot(aes(reorder(ID,Estimate), Estimate))+\n  geom_point()+\n  coord_flip()\n```\n\n::: {.cell-output-display}\n![](GLMs_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "GLMs_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}